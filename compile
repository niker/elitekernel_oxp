# delete everything
rm -fR ../a_compiled_out
mkdir ../a_compiled_out
mkdir ../a_compiled_out/kernel
mkdir ../a_compiled_out/system
mkdir ../a_compiled_out/system/lib
mkdir ../a_compiled_out/system/lib/modules
make clean

# make
make -j6

# copy modules

find . -type f -name '*.ko' -exec cp -f {} ../a_compiled_out/system/lib/modules \;

# copy zImage
cp -f ./arch/arm/boot/zImage ../a_compiled_out/kernel/

# ready for further editing
make clean

cp -f ../a_compiled_out/kernel/zImage ./kernelinjector.oxp/zImage.new/zImage
rm -fR ./kernelinjector.oxp/structure.new/modules/*
cp -fR ../a_compiled_out/system/lib/modules/* ./kernelinjector.oxp/structure.new/modules
cd kernelinjector.oxp
sh extract
sh compile
cd ..

